

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>syringe_pump.driver &mdash; Cavro Centris Syringe Pump 0.0.13.post10+g590589e documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/plot_directive.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Cavro Centris Syringe Pump
          

          
          </a>

          
            
            
              <div class="version">
                0.0.13.post10+g590589e
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html#quickstart-guide">Quickstart Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../driver.html">Driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../device.html">Device Level (DL)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../device_io.html">Device Level Input-Output</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release-history.html">Release History</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../min_versions.html">Minimum Version of Python and NumPy</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Cavro Centris Syringe Pump</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>syringe_pump.driver</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for syringe_pump.driver</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Authors: Valentyn Stadnytskyi</span>
<span class="sd">Date last modified: 06/19/2019</span>

<span class="sd">ASCII communication syntax:</span>
<span class="sd">“/“ indicates the start of a command sequence</span>
<span class="sd">The first character after the “/“ is the pump address: [1]</span>
<span class="sd">n-ASCII characters define the command sequence</span>
<span class="sd">“R” executes the command sequence (“F” executes on-the-fly changes)</span>
<span class="sd">“CR” or carriage return terminates the command sequence</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="c1">#if sys.version_info[0] &lt; 3:</span>
<span class="c1">#    raise Exception(&quot;Must be using Python 3&quot;)</span>
<span class="c1">#    str.encode(my_str)</span>
<span class="c1">#else:</span>

<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span><span class="p">,</span><span class="n">time</span>
<span class="kn">from</span> <span class="nn">logging</span> <span class="kn">import</span> <span class="n">debug</span><span class="p">,</span><span class="n">info</span><span class="p">,</span><span class="n">warning</span><span class="p">,</span><span class="n">error</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">pdb</span> <span class="kn">import</span> <span class="n">pm</span>

<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">nan</span><span class="p">,</span> <span class="n">inf</span>
<span class="kn">from</span> <span class="nn">threading</span> <span class="kn">import</span> <span class="n">RLock</span> <span class="k">as</span> <span class="n">Lock</span>

<div class="viewcode-block" id="Driver"><a class="viewcode-back" href="../../driver.html#syringe_pump.driver.Driver">[docs]</a><span class="k">class</span> <span class="nc">Driver</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orientation</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">serial_communication_dt</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="c1">#minimum distance between two.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pump_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_backlash</span> <span class="o">=</span> <span class="n">nan</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lock</span> <span class="o">=</span> <span class="n">Lock</span><span class="p">()</span>


<span class="c1">#  ############################################################################</span>
<span class="c1">#  RS-232 Communication Commands</span>
<span class="c1">#  ############################################################################</span>

<div class="viewcode-block" id="Driver.discover"><a class="viewcode-back" href="../../driver.html#syringe_pump.driver.Driver.discover">[docs]</a>    <span class="k">def</span> <span class="nf">discover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pump_id</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Finds the serial ports for the specified pump controller id number. uses self.available_ports class property to get all potential serial ports. Then submits the identification command. If the query return corrrect string and the id matches self.pump_id, the tested port will be assigned to self.port of the syringe pump driver class.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        port :: Serial</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; driver.port = driver.discover()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">serial</span> <span class="kn">import</span> <span class="n">Serial</span>

        <span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">version_info</span>
        <span class="k">if</span> <span class="n">pump_id</span>  <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pump_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pump_id</span>

        <span class="n">available_ports</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_ports</span>
        <span class="n">port</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">port_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_ports</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Trying self.port </span><span class="si">%s</span><span class="s2">...&quot;</span> <span class="o">%</span> <span class="n">port_name</span><span class="p">)</span>
                <span class="n">port</span> <span class="o">=</span> <span class="n">Serial</span><span class="p">(</span><span class="n">port_name</span><span class="p">,</span> <span class="n">timeout</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">port</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">available_ports</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">available_ports</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">port_name</span><span class="p">))</span>
        <span class="n">debug</span><span class="p">(</span><span class="s2">&quot;available ports </span><span class="si">{}</span><span class="s2">...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">available_ports</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">port_name</span> <span class="ow">in</span> <span class="n">available_ports</span><span class="p">:</span>
            <span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Trying port </span><span class="si">%s</span><span class="s2">...&quot;</span> <span class="o">%</span> <span class="n">port_name</span><span class="p">)</span>
            <span class="n">port</span> <span class="o">=</span> <span class="n">Serial</span><span class="p">(</span><span class="n">port_name</span><span class="p">,</span> <span class="n">timeout</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">port</span><span class="o">.</span><span class="n">baudrate</span> <span class="o">=</span> <span class="mi">9600</span>
            <span class="n">port</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">port</span><span class="o">.</span><span class="n">flushInput</span><span class="p">()</span>
            <span class="n">port</span><span class="o">.</span><span class="n">flushOutput</span><span class="p">()</span>
            <span class="n">full_reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">command</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;/1?80</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="n">port</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">full_reply</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">debug</span><span class="p">(</span><span class="s2">&quot;port </span><span class="si">%r</span><span class="s2">: full_reply </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">port_name</span><span class="p">,</span><span class="n">full_reply</span><span class="p">))</span>
                <span class="n">reply</span> <span class="o">=</span> <span class="n">full_reply</span><span class="p">[</span><span class="mi">3</span><span class="p">:][:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">status</span> <span class="o">=</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">received_pump_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;Latin-1&#39;</span><span class="p">))</span>
                <span class="n">debug</span><span class="p">(</span><span class="s2">&quot;self.ports </span><span class="si">%r</span><span class="s2">: full_reply </span><span class="si">%r</span><span class="s2">, status </span><span class="si">%r</span><span class="s2">, pump_id </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">port_name</span><span class="p">,</span><span class="n">full_reply</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">pump_id</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">received_pump_id</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">debug</span><span class="p">(</span><span class="s2">&quot;port </span><span class="si">%r</span><span class="s2">: full_reply </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">port_name</span><span class="p">,</span><span class="n">full_reply</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">received_pump_id</span> <span class="o">==</span> <span class="n">pump_id</span><span class="p">:</span> <span class="c1"># get pump id for new_pump</span>
                <span class="n">info</span><span class="p">(</span><span class="s2">&quot;self.port </span><span class="si">%r</span><span class="s2">: found pump </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">port_name</span><span class="p">,</span><span class="n">pump_id</span><span class="p">))</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">port</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="n">port</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">debug</span><span class="p">(</span><span class="s2">&quot;closing the serial connection&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">port</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">available_ports</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        return the list of serial devices</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list: list</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; driver.available_ports()</span>
<span class="sd">        [&#39;/dev/cu.usbserial&#39;,</span>
<span class="sd">         &#39;/dev/cu.usbserial1&#39;,</span>
<span class="sd">         &#39;/dev/cu.usbserial2&#39;,</span>
<span class="sd">         &#39;/dev/cu.usbserial3&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">platform</span> <span class="kn">import</span> <span class="n">system</span>
        <span class="kn">from</span> <span class="nn">serial.tools.list_ports</span> <span class="kn">import</span> <span class="n">comports</span>
        <span class="k">if</span> <span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Darwin&#39;</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="s1">&#39;cu.usbserial&#39;</span>
        <span class="k">elif</span> <span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Windows&#39;</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="s1">&#39;COM&#39;</span>
        <span class="k">elif</span> <span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Linux&#39;</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="s1">&#39;/dev/tty&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">port</span><span class="o">.</span><span class="n">device</span> <span class="k">for</span> <span class="n">port</span> <span class="ow">in</span> <span class="n">comports</span><span class="p">()</span> <span class="k">if</span> <span class="n">prefix</span> <span class="ow">in</span> <span class="n">port</span><span class="o">.</span><span class="n">device</span><span class="p">]</span>


<div class="viewcode-block" id="Driver.write"><a class="viewcode-back" href="../../driver.html#syringe_pump.driver.Driver.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">command</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        serial write command. the port attribute is optional. if port left None, the self.port object will be used. this fucnction is both Python 2 and 3 compatible.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        command: strin</span>
<span class="sd">            string command to be written into serial input buffer</span>
<span class="sd">        port: object</span>
<span class="sd">            serial port object</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; driver.write()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#command = bytes(command,encoding=&#39;Latin-1&#39;)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">command</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">bytes</span><span class="p">:</span>
            <span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Depreciation warning: expecting type bytes in write but received </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">command</span><span class="p">)</span>
            <span class="n">command</span> <span class="o">=</span> <span class="n">command</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;Latin-1&#39;</span><span class="p">)</span>
        <span class="n">debug</span><span class="p">(</span><span class="s1">&#39;encoding: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">command</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">port</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span>
        <span class="k">if</span> <span class="n">port</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">port</span><span class="o">.</span><span class="n">flushInput</span><span class="p">()</span>
            <span class="n">debug</span><span class="p">(</span><span class="s1">&#39;write(): pid </span><span class="si">%r</span><span class="s1"> and command = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pump_id</span><span class="p">,</span><span class="n">command</span><span class="p">))</span>
            <span class="n">port</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_command</span> <span class="o">=</span> <span class="n">command</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">error</span><span class="p">(</span><span class="s1">&#39;Port is not specified&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Driver.read"><a class="viewcode-back" href="../../driver.html#syringe_pump.driver.Driver.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        serial read command. the port attribute is optional. if port left None, the self.port object will be used. this fucnction is both Python 2 and 3 compatible.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        port: object</span>
<span class="sd">            serial port object</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        reply: string</span>
<span class="sd">            returns string from serial buffer</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; driver.read()</span>
<span class="sd">        &quot;ÿ/0`0\\x03\\r\\n&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">version_info</span>
        <span class="k">if</span> <span class="n">port</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span>
        <span class="k">if</span> <span class="n">port</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">reply</span> <span class="o">=</span> <span class="n">port</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_reply</span> <span class="o">=</span> <span class="n">reply</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">reply</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">debug</span><span class="p">(</span><span class="s2">&quot;read: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reply</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">reply</span></div>


<div class="viewcode-block" id="Driver.query"><a class="viewcode-back" href="../../driver.html#syringe_pump.driver.Driver.query">[docs]</a>    <span class="k">def</span> <span class="nf">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">command</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        write-read command with build in threading lock to insure no commands can be send within 100 ms, which is the syringe pump hardware limitation. first performs write into port and later read out serial buffer of the port object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        command: string</span>
<span class="sd">            string command to be written into serial port input buffer</span>

<span class="sd">        port: object</span>
<span class="sd">            serial port object</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        reply: string</span>
<span class="sd">            returns string from serial output buffer</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; driver.query(command = &#39;/1?29R\\r&#39;)</span>
<span class="sd">        &quot;ÿ/0`0\\x03\\r\\n&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>
        <span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">version_info</span>
        <span class="n">timeout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">serial_communication_dt</span>
        <span class="n">debug</span><span class="p">(</span><span class="s1">&#39;query(): pid </span><span class="si">{!r}</span><span class="s1"> and command = </span><span class="si">{!r}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pump_id</span><span class="p">,</span><span class="n">command</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">port</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span>
        <span class="k">if</span> <span class="n">port</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
                <span class="n">port</span><span class="o">.</span><span class="n">flushInput</span><span class="p">()</span>
                <span class="n">port</span><span class="o">.</span><span class="n">flushOutput</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">command</span> <span class="o">=</span> <span class="n">command</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="n">port</span><span class="p">)</span>
                <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">port</span> <span class="o">=</span> <span class="n">port</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">serial_communication_dt</span> <span class="o">-</span> <span class="p">(</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">t1</span><span class="p">)</span>
            <span class="n">debug</span><span class="p">(</span><span class="s1">&#39;query: left of dt = </span><span class="si">{:.3f}</span><span class="s1">. will sleep this amount&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dt</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">dt</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">dt</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">:</span> <span class="n">dt</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">sleep</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">reply</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#parsing reply</span>
        <span class="k">if</span> <span class="n">reply</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">reply</span> <span class="ow">is</span> <span class="ow">not</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="c1">#the positinonal reply \xff/0`0.000\x03\r\n is sandwiched between &#39;\x03\r\n&#39; and &#39;\xff/0&#39;</span>
            <span class="n">error_code</span> <span class="o">=</span> <span class="n">reply</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x03\r\n</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\xff</span><span class="s1">/0&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">reply</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x03\r\n</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\xff</span><span class="s1">/0&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
            <span class="nb">dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_error_code</span><span class="p">(</span><span class="n">error_code</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="n">value</span><span class="p">,</span><span class="s1">&#39;error_code&#39;</span><span class="p">:</span> <span class="n">error_code</span><span class="p">,</span> <span class="s1">&#39;busy&#39;</span><span class="p">:</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;busy&#39;</span><span class="p">],</span><span class="s1">&#39;error&#39;</span><span class="p">:</span><span class="nb">dict</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;error_code&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;busy&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;error&#39;</span><span class="p">:</span><span class="s1">&#39;no device found&#39;</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">result</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">waiting</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        returns number of byyes in both in and out buffers as tuple</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tuple</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; ser_port.waiting()</span>
<span class="sd">        (0,0)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">reply</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="o">.</span><span class="n">in_waiting</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="o">.</span><span class="n">out_waiting</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">reply</span>


<div class="viewcode-block" id="Driver.close"><a class="viewcode-back" href="../../driver.html#syringe_pump.driver.Driver.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        closes serial port</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; ser_port.close()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<span class="c1">####################################################################################################</span>
<span class="c1">### Syringe pumps commands</span>
<span class="c1">####################################################################################################</span>
    <span class="c1">### Atomic operations</span>

    <span class="k">def</span> <span class="nf">_get_position</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        queries position as an atomic command: &quot;&quot;/1?18R\\r&quot;</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        String</span>
<span class="sd">            unparse complete respponse string</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; driver._get_position()</span>
<span class="sd">            {&#39;value&#39;: b&#39;0.000&#39;, &#39;error_code&#39;: b&#39;`&#39;, &#39;busy&#39;: False, &#39;error&#39;: &#39;No Error&#39;}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">command</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;/1?18</span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">debug</span><span class="p">(</span><span class="s1">&#39;get_position(): reply = </span><span class="si">{!r}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reply</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">reply</span>

    <span class="k">def</span> <span class="nf">_set_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        queries set position as an atomic command: &quot;&#39;/1A&#39;+str(pos)+&#39;,1R\r&#39;&quot;</span>
<span class="sd">        FIXIT - can be this executed if plunger is moving?</span>
<span class="sd">        Example:</span>
<span class="sd">        &quot;/1A100.000,1R\\r&quot; move absolute to 100.0 uL</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        position: float</span>
<span class="sd">            input position as float</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        reply: string</span>
<span class="sd">            unparse complete response string</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; ser_port._set_position(10)</span>
<span class="sd">        {&#39;value&#39;: &#39;&#39;, &#39;error_code&#39;: &#39;@&#39;, &#39;busy&#39;: True, &#39;error&#39;: &#39;No Error&#39;}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">position</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">command</span> <span class="o">=</span> <span class="s1">&#39;/1A&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;,1R</span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
        <span class="n">debug</span><span class="p">(</span><span class="s1">&#39;_set_position(): reply = </span><span class="si">{!r}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reply</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">reply</span>
    <span class="n">_position</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_position</span><span class="p">,</span><span class="n">_set_position</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_speed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get speed as an atomic command</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        position: float</span>
<span class="sd">            input position as float</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        reply: string</span>
<span class="sd">            unparse complete response string</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; ser_port._get_speed()</span>
<span class="sd">         {&#39;value&#39;: &#39;25.000&#39;, &#39;error_code&#39;: &#39;`&#39;, &#39;busy&#39;: False, &#39;error&#39;: &#39;No Error&#39;}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">command</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;/1?37</span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
        <span class="n">number</span> <span class="o">=</span> <span class="n">reply</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
        <span class="n">debug</span><span class="p">(</span><span class="s1">&#39;get_speed(): reply = </span><span class="si">{}</span><span class="s1">, and number = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reply</span><span class="p">,</span><span class="n">number</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">reply</span>

    <span class="k">def</span> <span class="nf">_set_speed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">speed</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        set speed as an atomic command. can be executed if plunger is moving. If plunger is moving accepts speeds below 68.8.</span>
<span class="sd">        Example: &#39;&#39;</span>
<span class="sd">        &quot;/1V25.0,1F\\r&quot; set speed to 25.0 uL/s</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        speed: float</span>
<span class="sd">            input speed as float</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        reply: string</span>
<span class="sd">            unparse complete response string</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; driver._set_speed(speed = 25)</span>
<span class="sd">        {&#39;value&#39;: &#39;&#39;, &#39;error_code&#39;: &#39;@&#39;, &#39;busy&#39;: True, &#39;error&#39;: &#39;No Error&#39;}</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">spd</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">speed</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">command</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;/1V&#39;</span><span class="o">+</span><span class="nb">bytes</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">spd</span><span class="p">),</span> <span class="s1">&#39;Latin-1&#39;</span><span class="p">)</span><span class="o">+</span><span class="sa">b</span><span class="s1">&#39;,1R</span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">reply</span>

    <span class="k">def</span> <span class="nf">_set_speed_on_the_fly</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">speed</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        set speed as an atomic command on the fly. If plunger is moving accepts speeds below 68.8. Speeds above are rejected but no error is issued. Example: &quot;/1V25.0,1F&quot;\&quot;r&quot; set speed to 25.0 uL/s</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        reply: float</span>
<span class="sd">            current speed as float num,ber</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; driver._set_speed_on_the_fly(speed = 25)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">spd</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">speed</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">bytes_spd</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">spd</span><span class="p">),</span><span class="s1">&#39;Latin-1&#39;</span><span class="p">)</span>
        <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">command</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;/1V&#39;</span><span class="o">+</span><span class="n">bytes_spd</span><span class="o">+</span><span class="sa">b</span><span class="s1">&#39;,1F</span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">reply</span>
    <span class="n">_speed</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_speed</span><span class="p">,</span><span class="n">_set_speed</span><span class="p">)</span>

<div class="viewcode-block" id="Driver.get_speed"><a class="viewcode-back" href="../../driver.html#syringe_pump.driver.Driver.get_speed">[docs]</a>    <span class="k">def</span> <span class="nf">get_speed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get speed as an atomic command.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        reply: float</span>
<span class="sd">            current speed as float num,ber</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; driver.get_speed()</span>
<span class="sd">        25</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_speed</span>
        <span class="k">return</span> <span class="n">reply</span></div>
<div class="viewcode-block" id="Driver.set_speed"><a class="viewcode-back" href="../../driver.html#syringe_pump.driver.Driver.set_speed">[docs]</a>    <span class="k">def</span> <span class="nf">set_speed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">speed</span><span class="p">,</span> <span class="n">on_the_fly</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        set speed as an atomic command. can be executed if plunger is moving. If plunger is moving accepts speeds below 68.8.</span>
<span class="sd">        Example: &#39;/1V25.0,1F\\r&#39; set speed to 25.0 uL per s</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        speed: float</span>
<span class="sd">            input speed as float</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        reply: string</span>
<span class="sd">            unparse complete response string</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; driver.set_speed(speed = 25)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">spd</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">speed</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">on_the_fly</span><span class="p">:</span>
            <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_speed_on_the_fly</span><span class="p">(</span><span class="n">speed</span> <span class="o">=</span> <span class="n">spd</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">abort</span><span class="p">()</span>
            <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_speed</span><span class="p">(</span><span class="n">speed</span> <span class="o">=</span> <span class="n">spd</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">reply</span></div>
    <span class="n">speed</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_speed</span><span class="p">,</span><span class="n">set_speed</span><span class="p">)</span>


    <span class="c1">###Set up Commands</span>

<div class="viewcode-block" id="Driver.assign_volume"><a class="viewcode-back" href="../../driver.html#syringe_pump.driver.Driver.assign_volume">[docs]</a>    <span class="k">def</span> <span class="nf">assign_volume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">volume</span> <span class="o">=</span> <span class="mi">250</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Specifies the syringe volumes for each pump in the dictionary of</span>
<span class="sd">        pumps. The command takes effect after power cycling the pumps, and</span>
<span class="sd">        need only be executed once.</span>
<span class="sd">        accepts 4 different volumes: 50, 100, 250, 500 uL</span>
<span class="sd">        # volumes of            -&gt;      result in codes</span>
<span class="sd">        50, 100, 250, 500 uL    -&gt;      U93, U94, U90, U95</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        volume: integer</span>
<span class="sd">            input speed as float</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        reply: string</span>
<span class="sd">            unparse complete response string</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; driver.assign_volume(volume = 250)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">volumes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">volumes</span><span class="p">[</span><span class="mi">50</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;U93&#39;</span>
        <span class="n">volumes</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;U94&#39;</span>
        <span class="n">volumes</span><span class="p">[</span><span class="mi">250</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;U90&#39;</span>
        <span class="n">volumes</span><span class="p">[</span><span class="mi">500</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;U95&#39;</span>

        <span class="k">if</span> <span class="n">volume</span> <span class="ow">in</span> <span class="n">volumes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

            <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;/1&quot;</span><span class="o">+</span><span class="nb">bytes</span><span class="p">(</span><span class="n">volumes</span><span class="p">[</span><span class="n">volume</span><span class="p">],</span><span class="s1">&#39;Latin-1&#39;</span><span class="p">)</span><span class="o">+</span><span class="sa">b</span><span class="s2">&quot;R</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">reply</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;busy&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s2">&quot;volume of </span><span class="si">{}</span><span class="s2"> uL is not supported. Choose from </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">volume</span><span class="p">,</span><span class="n">volumes</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="s1">&#39;error_code&#39;</span><span class="p">:</span> <span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">reply</span></div>

<div class="viewcode-block" id="Driver.initialize"><a class="viewcode-back" href="../../driver.html#syringe_pump.driver.Driver.initialize">[docs]</a>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">orientation</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        initialization command: Y for left pumps and Z for right pumps</span>
<span class="sd">        Z: input on left, output on right</span>
<span class="sd">        Rotate valve CW to port 1; move the plunger to zero at speed 7 (default: 2.33 s per 30-mm stroke); rotate valve CW to port 2.</span>
<span class="sd">        Y: input on right, output on left</span>
<span class="sd">        Rotate valve CCW to Input port 1; move the plunger to zero at speed 7 (default: 2.33 s per 30-mm stroke); rotate valve CCW to Output port 2.</span>

<span class="sd">        The initialize command cannot be sent if motor is busy.</span>

<span class="sd">        Note: the initialization is done in safe way where the vavle is set to &#39;input&#39; before homing operation.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        orientation: string</span>
<span class="sd">            input orientation as string with two possible settings Y and Z</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        reply: string</span>
<span class="sd">            unparse complete response string</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; driver.initialize(orientation = &#39;Y&#39;)</span>
<span class="sd">        {&#39;value&#39;: &#39;&#39;, &#39;error_code&#39;: &#39;@&#39;, &#39;busy&#39;: True, &#39;error&#39;: &#39;No Error&#39;}</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">command</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">orientation</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span>
            <span class="n">command</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;Y7,0,0&#39;</span>
        <span class="k">elif</span> <span class="n">orientation</span> <span class="o">==</span> <span class="s1">&#39;Z&#39;</span><span class="p">:</span>
            <span class="n">command</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;Z7,0,0&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">reply</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">command</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">command</span> <span class="o">=</span><span class="sa">b</span><span class="s2">&quot;/1&quot;</span><span class="o">+</span><span class="n">command</span><span class="o">+</span><span class="sa">b</span><span class="s2">&quot;R</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">reply</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;busy&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Invalid Command, unknown orientation &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">orientation</span><span class="p">),</span> <span class="s1">&#39;error_code&#39;</span><span class="p">:</span> <span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orientation</span> <span class="o">=</span> <span class="n">orientation</span>
        <span class="k">return</span> <span class="n">reply</span></div>



<div class="viewcode-block" id="Driver.assign_pids"><a class="viewcode-back" href="../../driver.html#syringe_pump.driver.Driver.assign_pids">[docs]</a>    <span class="k">def</span> <span class="nf">assign_pids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">pid</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Assigns pump id to each syringe pump according to dictionary; since</span>
<span class="sd">        pump ids are written to non-volatile memory, need only execute once.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">command</span> <span class="o">=</span><span class="sa">b</span><span class="s2">&quot;/1s0ZA&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pump_id</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;Latin-1&#39;</span><span class="p">)</span><span class="o">+</span><span class="sa">b</span><span class="s2">&quot;R</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">reply</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">reply</span></div>

    <span class="k">def</span> <span class="nf">set_valve_orientation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">orientation</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>


<div class="viewcode-block" id="Driver.init"><a class="viewcode-back" href="../../driver.html#syringe_pump.driver.Driver.init">[docs]</a>    <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">pump_id</span><span class="p">,</span> <span class="n">speed</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span> <span class="n">backlash</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">orientation</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">volume</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        orderly initialization of the syringe pump: discovery of the pump, setting up and homing.</span>

<span class="sd">        - assigns pump_id class atribute to input pump_id</span>
<span class="sd">        - sets volume to input volumes</span>
<span class="sd">        - sets backlash</span>
<span class="sd">        - sets speed</span>
<span class="sd">        - sets orientation and homes the syringe pump.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pump_id: integer</span>
<span class="sd">            pump_id</span>
<span class="sd">        speed: float</span>
<span class="sd">            initial speed of the syringe pump, default is 25</span>
<span class="sd">        backlash: float</span>
<span class="sd">            the backlash of the syringe pump. The default value is 100</span>
<span class="sd">        orientation: string</span>
<span class="sd">            the orientation of the syringe pump valve: Y or Z</span>
<span class="sd">        volume: float</span>
<span class="sd">            the volume of the installed syringe</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; driver.init(pump_id = 1, speed = 25, backlash = 100,orientation = &#39;Y&#39;, volume = 250)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pump_id</span> <span class="o">=</span> <span class="n">pump_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">discover</span><span class="p">()</span>
        <span class="c1">#Initializes pump and sets it to correct orientation</span>
        <span class="k">if</span> <span class="n">volume</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assign_volume</span><span class="p">(</span><span class="n">volume</span> <span class="o">=</span> <span class="n">volume</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">backlash</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_backlash</span><span class="p">(</span><span class="n">backlash</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">speed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_speed</span><span class="p">(</span><span class="n">speed</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">orientation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="n">orientation</span> <span class="o">=</span> <span class="n">orientation</span><span class="p">)</span></div>

<div class="viewcode-block" id="Driver.abort"><a class="viewcode-back" href="../../driver.html#syringe_pump.driver.Driver.abort">[docs]</a>    <span class="k">def</span> <span class="nf">abort</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Terminates plunger moves [A,P,D] , initialization commands [Z], and delay [M]; does not affect valve moves.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; driver.abort()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">command</span>  <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;/1TR</span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">reply</span></div>

<div class="viewcode-block" id="Driver.home"><a class="viewcode-back" href="../../driver.html#syringe_pump.driver.Driver.home">[docs]</a>    <span class="k">def</span> <span class="nf">home</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        homes the syringe pump</span>
<span class="sd">        The homing parameters are hardcoded:</span>
<span class="sd">        +--------+-------+---------------+----------------+------------+</span>
<span class="sd">        | pump   | speed |  orientation  |   Backlash     | start pos  |</span>
<span class="sd">        +========+=======+===============+================+============+</span>
<span class="sd">        | pump1: |  25   |    Y          |  self.backlash |  0         |</span>
<span class="sd">        +--------+-------+---------------+----------------+------------+</span>
<span class="sd">        | pump2: |  25   |    Z          |  self.backlash |  0         |</span>
<span class="sd">        +--------+-------+---------------+----------------+------------+</span>
<span class="sd">        | pump3: |  25   |    Y          |  self.backlash |  0         |</span>
<span class="sd">        +--------+-------+---------------+----------------+------------+</span>
<span class="sd">        | pump4: |  25   |    Z          |  self.backlash |  0         |</span>
<span class="sd">        +--------+-------+---------------+----------------+------------+</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; driver.home()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># command = &#39;&#39;</span>
        <span class="c1"># command += &#39;/1&#39; # start</span>
        <span class="c1"># command += &#39;V&#39;+str(speed)+&#39;,1&#39; # at speed &#39;speed&#39; in uL(,1)</span>
        <span class="c1"># command += &#39;A&#39;+str(position)+&#39;,1&#39; # to position &#39;position&#39; in uL (,1)</span>
        <span class="c1"># command += &#39;R&#39; #execute loaded command symbol</span>
        <span class="c1"># command += &quot;\r&quot; #cariage return signalling the end of transmission</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pump_id</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">command</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
            <span class="n">command</span> <span class="o">+=</span> <span class="sa">b</span><span class="s1">&#39;/1&#39;</span> <span class="c1"># start</span>
            <span class="n">command</span> <span class="o">+=</span> <span class="sa">b</span><span class="s1">&#39;Y7,0,0&#39;</span> <span class="c1"># initialization command for left pumps and Z for right pumps</span>
            <span class="n">command</span> <span class="o">+=</span> <span class="sa">b</span><span class="s1">&#39;I&#39;</span> <span class="c1"># move the valve to position &#39;i&#39;</span>
            <span class="n">command</span> <span class="o">+=</span> <span class="sa">b</span><span class="s1">&#39;V25.0,1&#39;</span> <span class="c1"># set velocity to 25. V0.100,1</span>
            <span class="n">command</span> <span class="o">+=</span> <span class="sa">b</span><span class="s1">&#39;K&#39;</span> <span class="o">+</span> <span class="nb">bytes</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backlash</span><span class="p">),</span><span class="s1">&#39;Latin-1&#39;</span><span class="p">)</span> <span class="c1"># set backlash K&lt;n&gt;</span>
            <span class="n">command</span> <span class="o">+=</span> <span class="sa">b</span><span class="s1">&#39;A0.0,1&#39;</span> <span class="c1">#move plunger to absolute position of 0.0 uL</span>
            <span class="n">command</span> <span class="o">+=</span> <span class="sa">b</span><span class="s1">&#39;R&#39;</span> <span class="c1">#Execute loaded Command or Program String</span>
            <span class="n">command</span> <span class="o">+=</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\r</span><span class="s1">&#39;</span> <span class="c1">#</span>
            <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">pump_id</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;/1Z7,0,0IV25,1K&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backlash</span><span class="p">),</span><span class="s2">&quot;A0,1R</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">]),</span> <span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">pump_id</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;/1Y7,0,0IV25,1K&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backlash</span><span class="p">),</span><span class="s2">&quot;A0,1R</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">]),</span> <span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">pump_id</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;/1Z7,0,0IV25,1K&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backlash</span><span class="p">),</span><span class="s2">&quot;A0,1R</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">]),</span> <span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
        <span class="n">debug</span><span class="p">(</span><span class="s1">&#39;homing of motor </span><span class="si">%r</span><span class="s1">: reply = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pump_id</span><span class="p">,</span><span class="n">reply</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd_position</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">=</span> <span class="mf">25.0</span>
        <span class="k">return</span> <span class="n">reply</span></div>

<div class="viewcode-block" id="Driver.busy"><a class="viewcode-back" href="../../driver.html#syringe_pump.driver.Driver.busy">[docs]</a>    <span class="k">def</span> <span class="nf">busy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        queries if pump os busy or not. Command &quot;/1?29R\\r&quot;</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; driver.busy()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">command</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;/1?29R</span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
        <span class="n">debug</span><span class="p">(</span><span class="s1">&#39;busy(): reply = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">reply</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">reply</span></div>

    <span class="k">def</span> <span class="nf">get_valve</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">command</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;/1?20R</span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
        <span class="n">debug</span><span class="p">(</span><span class="s1">&#39;get_valve(): reply = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">reply</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">reply</span>

<div class="viewcode-block" id="Driver.set_valve"><a class="viewcode-back" href="../../driver.html#syringe_pump.driver.Driver.set_valve">[docs]</a>    <span class="k">def</span> <span class="nf">set_valve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        valve : char</span>
<span class="sd">            one character command for the valve position &#39;b&#39;,&#39;o&#39;,&#39;i&#39;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        reply : dictionary</span>
<span class="sd">            a dictionary containing 4 key-value pairs</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; self.set_valve(b&#39;i&#39;)</span>
<span class="sd">        {&#39;value&#39;: b&#39;&#39;, &#39;error_code&#39;: 64, &#39;busy&#39;: False, &#39;error&#39;: None}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="s1">&#39;Latin-1&#39;</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">command</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">b</span><span class="s2">&quot;/1&quot;</span><span class="p">,</span><span class="n">value</span><span class="p">,</span><span class="sa">b</span><span class="s2">&quot;R</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">]))</span>
        <span class="n">debug</span><span class="p">(</span><span class="s1">&#39;set_valve(value = </span><span class="si">%r</span><span class="s1">): reply = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="n">reply</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">reply</span></div>
    <span class="n">valve</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_valve</span><span class="p">,</span><span class="n">set_valve</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_backlash</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backlash</span>
<div class="viewcode-block" id="Driver.set_backlash"><a class="viewcode-back" href="../../driver.html#syringe_pump.driver.Driver.set_backlash">[docs]</a>    <span class="k">def</span> <span class="nf">set_backlash</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">command</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;/1K&#39;</span><span class="o">+</span><span class="nb">bytes</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)),</span><span class="s1">&#39;Latin-1&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;R</span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
        <span class="n">debug</span><span class="p">(</span><span class="s1">&#39;set_backlash(): reply = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">reply</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_backlash</span> <span class="o">=</span> <span class="n">value</span></div>
    <span class="n">backlash</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_backlash</span><span class="p">,</span> <span class="n">set_backlash</span><span class="p">)</span>

<div class="viewcode-block" id="Driver.convert_error_code"><a class="viewcode-back" href="../../driver.html#syringe_pump.driver.Driver.convert_error_code">[docs]</a>    <span class="k">def</span> <span class="nf">convert_error_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">char</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        the ` is \x60 character or chr(96)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">error_codes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">error_codes</span><span class="p">[</span><span class="sa">b</span><span class="s1">&#39;`&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;busy&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span><span class="s1">&#39;error&#39;</span><span class="p">:</span><span class="s1">&#39;No Error&#39;</span><span class="p">}</span>
        <span class="n">error_codes</span><span class="p">[</span><span class="sa">b</span><span class="s1">&#39;@&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;busy&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;error&#39;</span><span class="p">:</span><span class="s1">&#39;No Error&#39;</span><span class="p">}</span>
        <span class="n">error_codes</span><span class="p">[</span><span class="sa">b</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;busy&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span><span class="s1">&#39;error&#39;</span><span class="p">:</span><span class="s1">&#39;Initialization Error&#39;</span><span class="p">}</span>
        <span class="n">error_codes</span><span class="p">[</span><span class="sa">b</span><span class="s1">&#39;A&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;busy&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;error&#39;</span><span class="p">:</span><span class="s1">&#39;Initialization Error&#39;</span><span class="p">}</span>
        <span class="n">error_codes</span><span class="p">[</span><span class="sa">b</span><span class="s1">&#39;b&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;busy&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span><span class="s1">&#39;error&#39;</span><span class="p">:</span><span class="s1">&#39;Invalid Command&#39;</span><span class="p">}</span>
        <span class="n">error_codes</span><span class="p">[</span><span class="sa">b</span><span class="s1">&#39;B&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;busy&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;error&#39;</span><span class="p">:</span><span class="s1">&#39;Invalid Command&#39;</span><span class="p">}</span>
        <span class="n">error_codes</span><span class="p">[</span><span class="sa">b</span><span class="s1">&#39;c&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;busy&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span><span class="s1">&#39;error&#39;</span><span class="p">:</span><span class="s1">&#39;Invalid Operand&#39;</span><span class="p">}</span>
        <span class="n">error_codes</span><span class="p">[</span><span class="sa">b</span><span class="s1">&#39;C&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;busy&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;error&#39;</span><span class="p">:</span><span class="s1">&#39;Invalid Operand&#39;</span><span class="p">}</span>
        <span class="n">error_codes</span><span class="p">[</span><span class="sa">b</span><span class="s1">&#39;i&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;busy&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span><span class="s1">&#39;error&#39;</span><span class="p">:</span><span class="s1">&#39;Plunger Overload&#39;</span><span class="p">}</span>
        <span class="n">error_codes</span><span class="p">[</span><span class="sa">b</span><span class="s1">&#39;I&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;busy&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;error&#39;</span><span class="p">:</span><span class="s1">&#39;Plunger Overload&#39;</span><span class="p">}</span>
        <span class="c1"># need to be added FIXIT</span>
        <span class="c1"># 7	    g 	G 	Device Not Initialized</span>
        <span class="c1"># 8	    h 	H 	Invalid Valve Configuration</span>
        <span class="c1"># 9	    i 	I</span>
        <span class="c1"># 10	j 	J 	Valve Overload</span>
        <span class="c1"># 11	k 	K 	Plunger Move Not Allowed</span>
        <span class="c1"># 12	l 	L 	Extended Error Present</span>
        <span class="c1"># 13	m 	M 	Nvmem Access Failure</span>
        <span class="c1"># 14	n 	N 	Command Buffer Empty or Not Ready</span>
        <span class="n">error_codes</span><span class="p">[</span><span class="sa">b</span><span class="s1">&#39;o&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;busy&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span><span class="s1">&#39;error&#39;</span><span class="p">:</span><span class="s1">&#39;Command Buffer Overflow&#39;</span><span class="p">}</span>
        <span class="n">error_codes</span><span class="p">[</span><span class="sa">b</span><span class="s1">&#39;O&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;busy&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;error&#39;</span><span class="p">:</span><span class="s1">&#39;Command Buffer Overflow&#39;</span><span class="p">}</span>


        <span class="k">if</span> <span class="n">char</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">error_codes</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">return</span> <span class="n">error_codes</span><span class="p">[</span><span class="n">char</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;busy&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;error&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">}</span></div>

<div class="viewcode-block" id="Driver.reset"><a class="viewcode-back" href="../../driver.html#syringe_pump.driver.Driver.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Performs a soft reset on pumps&quot;&quot;&quot;</span>
        <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;/1!R</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
        <span class="n">debug</span><span class="p">(</span><span class="s1">&#39;reset(): reply = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">reply</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">reply</span></div>

    <span class="c1">#Compund commands</span>

<div class="viewcode-block" id="Driver.move_abs"><a class="viewcode-back" href="../../driver.html#syringe_pump.driver.Driver.move_abs">[docs]</a>    <span class="k">def</span> <span class="nf">move_abs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">position</span><span class="p">,</span> <span class="n">speed</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Move plunger of pump[pid] to absolute position.</span>
<span class="sd">        Plunger moves can be executed in increments or volume</span>
<span class="sd">        by appending to the destination ‘,0’ or ‘,1’.</span>
<span class="sd">        There are 181,490 increments in a 30-mm stroke.</span>
<span class="sd">        The volume in uL is internally calculated from the syringe volume (specified by a U command).</span>
<span class="sd">        Two arguments need to be passed: position and speed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">position</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">position</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">command</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
        <span class="n">command</span> <span class="o">+=</span> <span class="sa">b</span><span class="s1">&#39;/1&#39;</span> <span class="c1"># start</span>
        <span class="n">command</span> <span class="o">+=</span> <span class="sa">b</span><span class="s1">&#39;V&#39;</span><span class="o">+</span><span class="nb">bytes</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">speed</span><span class="p">),</span><span class="s1">&#39;Latin-1&#39;</span><span class="p">)</span><span class="o">+</span><span class="sa">b</span><span class="s1">&#39;,1&#39;</span> <span class="c1"># at speed &#39;speed&#39; in uL(,1)</span>
        <span class="n">command</span> <span class="o">+=</span> <span class="sa">b</span><span class="s1">&#39;A&#39;</span><span class="o">+</span><span class="nb">bytes</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">position</span><span class="p">),</span><span class="s1">&#39;Latin-1&#39;</span><span class="p">)</span><span class="o">+</span><span class="sa">b</span><span class="s1">&#39;,1&#39;</span> <span class="c1"># to position &#39;position&#39; in uL (,1) A100.0,1</span>
        <span class="n">command</span> <span class="o">+=</span> <span class="sa">b</span><span class="s1">&#39;R&#39;</span> <span class="c1">#execute loaded command symbol</span>
        <span class="n">command</span> <span class="o">+=</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\r</span><span class="s1">&#39;</span> <span class="c1">#cariage return signalling the end of transmission</span>
        <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">command</span> <span class="o">=</span> <span class="n">command</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">reply</span></div>


<div class="viewcode-block" id="Driver.move_rel"><a class="viewcode-back" href="../../driver.html#syringe_pump.driver.Driver.move_rel">[docs]</a>    <span class="k">def</span> <span class="nf">move_rel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">position</span><span class="p">,</span><span class="n">speed</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Move plunger of pump[pid] to relative position.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abort</span><span class="p">()</span>
        <span class="n">current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_position</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">position</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">position</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
            <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;/1J2V&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">speed</span><span class="p">),</span><span class="s2">&quot;,1D&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">position</span><span class="p">),</span><span class="s2">&quot;,1J0R</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">]),</span> <span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">reply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;/1J2V&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">speed</span><span class="p">),</span><span class="s2">&quot;,1P&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">position</span><span class="p">),</span><span class="s2">&quot;,1J0R</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">]),</span> <span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">reply</span></div></div>



<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">tempfile</span> <span class="kn">import</span> <span class="n">gettempdir</span>

    <span class="kn">import</span> <span class="nn">logging</span><span class="p">;</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="c1">#filename=gettempdir()+&#39;/syringe_pump_driver.log&#39;,</span>
                                        <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2">: </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;--- For Debugging ---&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;self = driver = Driver()&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;driver.discover()&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;driver.init(pump_id=1, speed=25, backlash=100, orientation=&#39;Y&#39;, volume=250)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;self.port = self.discover(1)&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;self.init(3,25,100,&quot;Y&quot;,250)&#39;</span><span class="p">)</span>



    <span class="c1">#self.discover()</span>

    <span class="c1">#functions tested</span>
    <span class="c1"># write</span>
    <span class="c1"># read</span>
    <span class="c1"># query</span>
    <span class="c1"># discover</span>

    <span class="c1"># initialize</span>
    <span class="c1"># _get_position</span>
    <span class="c1"># _set_position</span>
    <span class="c1"># _get_speed</span>
    <span class="c1"># _set_speed</span>
    <span class="c1"># _set_speed_on_the_fly</span>
    <span class="c1"># assign_volume</span>
    <span class="c1"># assign_pids</span>
    <span class="c1"># convert_error_code</span>
    <span class="c1"># abort</span>
    <span class="c1"># move_abs</span>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2017, Valentyn Stadnytskyi.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>